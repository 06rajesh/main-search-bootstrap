!function(e){var t="function"==typeof e.define&&e.define.amd,n="object",o="function",r="undefined",i=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],a=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],s=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],c=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function d(e,t){var r=typeof e[t];return r==o||!(r!=n||!e[t])||"unknown"==r}function f(e,t){return!(typeof e[t]!=n||!e[t])}function u(e,t){return typeof e[t]!=r}function l(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}var h=l(d),g=l(f),p=l(u);function m(e){return e&&h(e,c)&&p(e,s)}function R(e){return f(e,"body")?e.body:e.getElementsByTagName("body")[0]}var v,C={},N={version:"1.3alpha.804",initialized:!1,supported:!0,util:{isHostMethod:d,isHostObject:f,isHostProperty:u,areHostMethods:h,areHostObjects:g,areHostProperties:p,isTextRange:m,getBody:R},features:{},modules:C,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};function E(e){f(window,"console")&&d(window.console,"log")&&window.console.log(e)}function S(e,t){t?window.alert(e):E(e)}function w(e){N.initialized=!0,N.supported=!1,S("Rangy is not supported on this page in your browser. Reason: "+e,N.config.alertOnFail)}N.fail=w,N.warn=function(e){S("Rangy warning: "+e,N.config.alertOnWarn)},!{}.hasOwnProperty?w("hasOwnProperty not supported"):N.util.extend=function(e,t,n){var o,r;for(var i in t)t.hasOwnProperty(i)&&(o=e[i],r=t[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&N.util.extend(o,r,!0),e[i]=r);return e},function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(e){}t||(t=function(e){for(var t=[],n=0,o=e.length;n<o;++n)t[n]=e[n];return t}),N.util.toArray=t}(),d(document,"addEventListener")?v=function(e,t,n){e.addEventListener(t,n,!1)}:d(document,"attachEvent")?v=function(e,t,n){e.attachEvent("on"+t,n)}:w("Document does not have required addEventListener or attachEvent method"),N.util.addListener=v;var O=[];function y(e){return e.message||e.description||String(e)}function T(){if(!N.initialized){var e,t=!1,n=!1;d(document,"createRange")&&(e=document.createRange(),h(e,a)&&p(e,i)&&(t=!0),e.detach());var o=R(document);if(o&&"body"==o.nodeName.toLowerCase())if(o&&d(o,"createTextRange")&&m(e=o.createTextRange())&&(n=!0),t||n){var r;N.initialized=!0,N.features={implementsDomRange:t,implementsTextRange:n};for(var s in C)(r=C[s])instanceof D&&r.init(r,N);for(var c=0,f=O.length;c<f;++c)try{O[c](N)}catch(e){E("Rangy init listener threw an exception. Continuing. Detail: "+y(e))}}else w("Neither Range nor TextRange are available");else w("No body element found")}}N.init=T,N.addInitListener=function(e){N.initialized?e(N):O.push(e)};var _=[];function D(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function A(e,t,n,o){var r=new D(t,n,function(e){if(!e.initialized){e.initialized=!0;try{o(N,e),e.supported=!0}catch(e){E("Module '"+t+"' failed to load: "+y(e))}}});C[t]=r}function x(){}N.addCreateMissingNativeApiListener=function(e){_.push(e)},N.createMissingNativeApi=function(e){e=e||window,T();for(var t=0,n=_.length;t<n;++t)_[t](e)},D.prototype={init:function(e){for(var t,n,o=this.dependencies||[],r=0,i=o.length;r<i;++r){if(n=o[r],!((t=C[n])&&t instanceof D))throw new Error("required module '"+n+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+n+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){N.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){N.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},N.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),A(0,e,n,t)},N.createCoreModule=function(e,t,n){A(0,e,t,n)},N.RangePrototype=x,N.rangePrototype=new x,N.selectionPrototype=new function(){};var P=!1,b=function(e){P||(P=!0,N.initialized||T())};typeof window!=r?typeof document!=r?(d(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",b,!1),v(window,"load",b),t&&e.define(function(){return N.amd=!0,N}),e.rangy=N):w("No document found"):w("No window found")}(this),rangy.createCoreModule("DomUtil",[],function(e,t){var n="undefined",o=e.util;o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),o.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var r=document.createElement("div");o.areHostMethods(r,["insertBefore","appendChild","cloneNode"]||!o.areHostObjects(r,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),o.isHostProperty(r,"innerHTML")||t.fail("Element is missing innerHTML property");var i=document.createTextNode("test");o.areHostMethods(i,["splitText","deleteData","insertData","appendData","cloneNode"]||!o.areHostObjects(r,["previousSibling","nextSibling","childNodes","parentNode"])||!o.areHostProperties(i,["data"]))||t.fail("Incomplete Text Node implementation");var a=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function s(e){for(var t=0;e=e.previousSibling;)++t;return t}function c(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(a(o,n))return n;return null}function d(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function f(e,t,n){for(var o,r=n?e:e.parentNode;r;){if((o=r.parentNode)===t)return r;r=o}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function l(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function h(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=n)return e.ownerDocument;if(typeof e.document!=n)return e.document;if(e.parentNode)return h(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var o=h(e);if(typeof o.defaultView!=n)return o.defaultView;if(typeof o.parentWindow!=n)return o.parentWindow;throw t.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=n)return e.contentDocument;if(typeof e.contentWindow!=n)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function m(e){return e&&o.isHostMethod(e,"setTimeout")&&o.isHostObject(e,"document")}var R,v=!1;function C(e){try{return e.parentNode,!1}catch(e){return!0}}function N(e){if(!e)return"[No node]";if(v&&C(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+s(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function E(e){this.root=e,this._next=e}function S(e,t){this.node=e,this.offset=t}function w(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",v=C(n),e.features.crashyTextNodes=v}(),typeof window.getComputedStyle!=n?R=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=n?R=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),E.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},S.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+N(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},w.prototype.toString=function(){return this.message},e.dom={arrayContains:a,isHtmlNamespace:function(e){var t;return typeof e.namespaceURI==n||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(e){var t=e.parentNode;return 1==t.nodeType?t:null},getNodeIndex:s,getNodeLength:function(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},getCommonAncestor:c,isAncestorOf:d,isOrIsAncestorOf:function(e,t){return d(e,t,!0)},getClosestAncestorIn:f,isCharacterDataNode:u,isTextOrCommentNode:function(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t},insertAfter:l,splitDataNode:function(e,t,n){var o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),l(o,e),n)for(var r,i=0;r=n[i++];)r.node==e&&r.offset>t?(r.node=o,r.offset-=t):r.node==e.parentNode&&r.offset>s(e)&&++r.offset;return o},getDocument:h,getWindow:g,getIframeWindow:function(e){if(typeof e.contentWindow!=n)return e.contentWindow;if(typeof e.contentDocument!=n)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:p,getBody:o.getBody,isWindow:m,getContentDocument:function(e,t,n){var r;if(e?o.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p(e):h(e):m(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r},getRootContainer:function(e){for(var t;t=e.parentNode;)e=t;return e},comparePoints:function(e,n,o,r){var i,a,d,u,l;if(e==o)return n===r?0:n<r?-1:1;if(i=f(o,e,!0))return n<=s(i)?-1:1;if(i=f(e,o,!0))return s(i)<r?-1:1;if(!(a=c(e,o)))throw new Error("comparePoints error: nodes have no common ancestor");if((d=e===a?a:f(e,a,!0))===(u=o===a?a:f(o,a,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(l=a.firstChild;l;){if(l===d)return-1;if(l===u)return 1;l=l.nextSibling}},isBrokenNode:C,inspectNode:N,getComputedStyleProperty:R,fragmentFromNodeChildren:function(e){for(var t,n=h(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n},createIterator:function(e){return new E(e)},DomPosition:S},e.DOMException=w}),rangy.createCoreModule("DomRange",["DomUtil"],function(e,t){var n=e.dom,o=e.util,r=n.DomPosition,i=e.DOMException,a=n.isCharacterDataNode,s=n.getNodeIndex,c=n.isOrIsAncestorOf,d=n.getDocument,f=n.comparePoints,u=n.splitDataNode,l=n.getClosestAncestorIn,h=n.getNodeLength,g=n.arrayContains,p=n.getRootContainer,m=e.features.crashyTextNodes;function R(e,t){return 3!=e.nodeType&&(c(e,t.startContainer)||c(e,t.endContainer))}function v(e){return e.document||d(e.startContainer)}function C(e){return new r(e.parentNode,s(e))}function N(e){return new r(e.parentNode,s(e)+1)}function E(e,t,o){var r=11==e.nodeType?e.firstChild:e;return a(t)?o==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,0==o?t:u(t,o)):o>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[o]),r}function S(e,t,n){if(Q(e),Q(t),v(t)!=v(e))throw new i("WRONG_DOCUMENT_ERR");var o=f(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=f(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&r>=0:o<0&&r>0}function w(e,t,o){var r,i,a,s;for(o=o||{stop:!1};a=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(a))return void(o.stop=!0);if(w(s=e.getSubtreeIterator(),t,o),s.detach(!0),o.stop)return}else for(r=n.createIterator(a);i=r.next();)if(!1===t(i))return void(o.stop=!0)}function O(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(O(t=e.getSubtreeIterator()),t.detach(!0)):e.remove()}function y(e){for(var t,n,o=v(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(y(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new i("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function T(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function _(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&a(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||a(this.sc)?l(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||a(this.ec)?l(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function D(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}_.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,a(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!a(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e)},isPartiallySelectedSubtree:function(){return R(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new he(v(this.range));var t=this._current,n=t,o=0,r=t,i=h(t);c(t,this.sc)&&(n=this.sc,o=this.so),c(t,this.ec)&&(r=this.ec,i=this.eo),le(e,n,o,r,i)}return new _(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},D.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},D.prototype.toString=function(){return this.message};var A=[1,3,4,5,7,8,10],x=[2,9,11],P=[1,3,4,5,7,8,10,11],b=[1,3,4,5,7,8];function I(e){return function(t,n){for(var o,r=n?t:t.parentNode;r;){if(o=r.nodeType,g(e,o))return r;r=r.parentNode}return null}}var B=I([9,11]),H=I([5,6,10,12]),M=I([6,10,12]);function L(e,t){if(M(e,t))throw new D("INVALID_NODE_TYPE_ERR")}function W(e){if(!e.startContainer)throw new i("INVALID_STATE_ERR")}function k(e,t){if(!g(t,e.nodeType))throw new D("INVALID_NODE_TYPE_ERR")}function F(e,t){if(t<0||t>(a(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function U(e,t){if(B(e,!0)!==B(t,!0))throw new i("WRONG_DOCUMENT_ERR")}function j(e){if(H(e,!0))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function V(e,t){if(!e)throw new i(t)}function z(e){return m&&n.isBrokenNode(e)||!g(x,e.nodeType)&&!B(e,!0)}function Y(e,t){return t<=(a(e)?e.length:e.childNodes.length)}function q(e){return!!e.startContainer&&!!e.endContainer&&!z(e.startContainer)&&!z(e.endContainer)&&Y(e.startContainer,e.startOffset)&&Y(e.endContainer,e.endOffset)}function Q(e){if(W(e),!q(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}var G=document.createElement("style"),X=!1;try{G.innerHTML="<b>x</b>",X=3==G.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=X;var Z=X?function(e){var t=this.startContainer,o=d(t);if(!t)throw new i("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:a(t)&&(r=n.parentElement(t)),(r=null===r||"HTML"==r.nodeName&&n.isHtmlNamespace(d(r).documentElement)&&n.isHtmlNamespace(r)?o.createElement("body"):r.cloneNode(!1)).innerHTML=e,n.fragmentFromNodeChildren(r)}:function(e){W(this);var t=v(this).createElement("body");return t.innerHTML=e,n.fragmentFromNodeChildren(t)};function $(e,t){Q(e);var n=e.startContainer,o=e.startOffset,r=e.endContainer,i=e.endOffset,c=n===r;a(r)&&i>0&&i<r.length&&u(r,i,t),a(n)&&o>0&&o<n.length&&(n=u(n,o,t),c?(i-=o,r=n):r==n.parentNode&&i>=s(n)&&i++,o=0),e.setStartAndEnd(n,o,r,i)}var J=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],K=0,ee=1,te=2,ne=3,oe=0,re=1,ie=2,ae=3;function se(e){e.START_TO_START=K,e.START_TO_END=ee,e.END_TO_END=te,e.END_TO_START=ne,e.NODE_BEFORE=oe,e.NODE_AFTER=re,e.NODE_BEFORE_AND_AFTER=ie,e.NODE_INSIDE=ae}function ce(e){se(e),se(e.prototype)}function de(e,t){return function(){Q(this);var n,o=this.startContainer,r=this.startOffset,i=this.commonAncestorContainer,a=new _(this,!0);o!==i&&(o=(n=N(l(o,i,!0))).node,r=n.offset),w(a,j),a.reset();var s=e(a);return a.detach(),t(this,o,r,o,r),s}}function fe(t,n,r){function i(e,t){return function(n){W(this),k(n,A),k(p(n),x);var o=(e?C:N)(n);(t?c:d)(this,o.node,o.offset)}}function c(e,t,o){var r=e.endContainer,i=e.endOffset;t===e.startContainer&&o===e.startOffset||(p(t)==p(r)&&1!=f(t,o,r,i)||(r=t,i=o),n(e,t,o,r,i))}function d(e,t,o){var r=e.startContainer,i=e.startOffset;t===e.endContainer&&o===e.endOffset||(p(t)==p(r)&&-1!=f(t,o,r,i)||(r=t,i=o),n(e,r,i,t,o))}var u=function(){};u.prototype=e.rangePrototype,t.prototype=new u,o.extend(t.prototype,{setStart:function(e,t){W(this),L(e,!0),F(e,t),c(this,e,t)},setEnd:function(e,t){W(this),L(e,!0),F(e,t),d(this,e,t)},setStartAndEnd:function(){W(this);var e=arguments,t=e[0],o=e[1],r=t,i=o;switch(e.length){case 3:i=e[2];break;case 4:r=e[2],i=e[3]}n(this,t,o,r,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){Q(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){W(this),L(e,!0),n(this,e,0,e,h(e))},selectNode:function(e){W(this),L(e,!1),k(e,A);var t=C(e),o=N(e);n(this,t.node,t.offset,o.node,o.offset)},extractContents:de(y,n),deleteContents:de(O,n),canSurroundContents:function(){Q(this),j(this.startContainer),j(this.endContainer);var e=new _(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},detach:function(){r(this)},splitBoundaries:function(){$(this)},splitBoundariesPreservingPositions:function(e){$(this,e)},normalizeBoundaries:function(){Q(this);var e=this.startContainer,t=this.startOffset,o=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},c=function(n){var i=n.previousSibling;if(i&&i.nodeType==n.nodeType){e=n;var a=n.length;if(t=i.length,n.insertData(0,i.data),i.parentNode.removeChild(i),e==o)r+=t,o=e;else if(o==n.parentNode){var c=s(n);r==c?(o=n,r=a):r>c&&r--}}},d=!0;if(a(o))o.length==r&&i(o);else{if(r>0){var f=o.childNodes[r-1];f&&a(f)&&i(f)}d=!this.collapsed}if(d){if(a(e))0==t&&c(e);else if(t<e.childNodes.length){var u=e.childNodes[t];u&&a(u)&&c(u)}}else e=o,t=r;n(this,e,t,o,r)},collapseToPoint:function(e,t){W(this),L(e,!0),F(e,t),this.setStartAndEnd(e,t)}}),ce(t)}function ue(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:n.getCommonAncestor(e.startContainer,e.endContainer)}function le(e,t,o,r,i){e.startContainer=t,e.startOffset=o,e.endContainer=r,e.endOffset=i,e.document=n.getDocument(t),ue(e)}function he(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,ue(this)}o.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){var n,o,r,i;Q(this),U(this.startContainer,t.startContainer);var a=e==ne||e==K?"start":"end",s=e==ee||e==K?"start":"end";return n=this[a+"Container"],o=this[a+"Offset"],r=t[s+"Container"],i=t[s+"Offset"],f(n,o,r,i)},insertNode:function(e){if(Q(this),k(e,P),j(this.startContainer),c(e,this.startContainer))throw new i("HIERARCHY_REQUEST_ERR");var t=E(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t;if(Q(this),this.collapsed)return v(this).createDocumentFragment();if(this.startContainer===this.endContainer&&a(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=v(this).createDocumentFragment()).appendChild(e),t;var n=new _(this,!0);return e=function e(t){for(var n,o,r,a=v(t.range).createDocumentFragment();o=t.next();){if(n=t.isPartiallySelectedSubtree(),o=o.cloneNode(!n),n&&(r=t.getSubtreeIterator(),o.appendChild(e(r)),r.detach(!0)),10==o.nodeType)throw new i("HIERARCHY_REQUEST_ERR");a.appendChild(o)}return a}(n),n.detach(),e},canSurroundContents:function(){Q(this),j(this.startContainer),j(this.endContainer);var e=new _(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},surroundContents:function(e){if(k(e,b),!this.canSurroundContents())throw new D("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);E(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){Q(this);for(var e,t=new he(v(this)),n=J.length;n--;)t[e=J[n]]=this[e];return t},toString:function(){Q(this);var e=this.startContainer;if(e===this.endContainer&&a(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new _(this,!0);return w(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){Q(this);var t=e.parentNode,n=s(e);if(!t)throw new i("NOT_FOUND_ERR");var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return o<0?r>0?ie:oe:r>0?re:ae},comparePoint:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),U(e,this.startContainer),f(e,t,this.startContainer,this.startOffset)<0?-1:f(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){Q(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(Q(this),V(e,"NOT_FOUND_ERR"),d(e)!==v(this))return!1;var n=e.parentNode,o=s(e);V(n,"NOT_FOUND_ERR");var r=f(n,o,this.endContainer,this.endOffset),i=f(n,o+1,this.startContainer,this.startOffset);return t?r<=0&&i>=0:r<0&&i>0},isPointInRange:function(e,t){return Q(this),V(e,"HIERARCHY_REQUEST_ERR"),U(e,this.startContainer),f(e,t,this.startContainer,this.startOffset)>=0&&f(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return S(this,e,!1)},intersectsOrTouchesRange:function(e){return S(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=f(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=f(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==f(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==f(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new D("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ae},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,h(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var o=n.pop();t.setEnd(o,o.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},getNodes:function(e,t){return Q(this),function(e,t,n){var o,r=!(!t||!t.length),i=!!n;r&&(o=new RegExp("^("+t.join("|")+")$"));var s=[];return w(new _(e,!1),function(t){if((!r||o.test(t.nodeType))&&(!i||n(t))){var c=e.startContainer;if(t!=c||!a(c)||e.startOffset!=c.length){var d=e.endContainer;t==d&&a(d)&&0==e.endOffset||s.push(t)}}}),s}(this,e,t)},getDocument:function(){return v(this)},collapseBefore:function(e){W(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){W(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var o=v(this),r=e.createRange(o);t=t||n.getBody(o),r.selectNodeContents(t);var i=this.intersection(r),a=0,s=0;return i&&(r.setEnd(i.startContainer,i.startOffset),s=(a=r.toString().length)+i.toString().length,r.detach()),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var o,r,i,a,s=[t],c=!1,d=!1;!d&&(o=s.pop());)if(3==o.nodeType)r=n+o.length,!c&&e.start>=n&&e.start<=r&&(this.setStart(o,e.start-n),c=!0),c&&e.end>=n&&e.end<=r&&(this.setEnd(o,e.end-n),d=!0),n=r;else for(i=(a=o.childNodes).length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return he.rangesEqual(this,e)},isValid:function(){return q(this)},inspect:function(){return T(this)}}),fe(he,le,function(e){W(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}),o.extend(he,{rangeProperties:J,RangeIterator:_,copyComparisonConstants:ce,createPrototypeRange:fe,inspect:T,getRangeDocument:v,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=he,e.RangeException=D}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,o,r=e.dom,i=e.util,a=r.DomPosition,s=e.DomRange,c=r.getBody,d=r.getContentDocument,f=r.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var o,a,f=s.rangeProperties;function u(e){for(var t,n=f.length;n--;)e[t=f[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,function(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==o||e.endOffset!=r,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(o,r),e.setStart(t,n))},function(e){e.nativeRange.detach(),e.detached=!0;for(var t=f.length;t--;)e[f[t]]=null}),(o=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),u(this)},o.cloneContents=function(){return this.nativeRange.cloneContents()},o.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},o.collapse=function(e){this.nativeRange.collapse(e),u(this)},o.cloneRange=function(){return new n(this.nativeRange.cloneRange())},o.refresh=function(){u(this)},o.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");c(document).appendChild(l);var h=document.createRange();h.setStart(l,0),h.setEnd(l,0);try{h.setStart(l,1),o.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},o.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},a=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(e){o.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},o.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}o.setStartBefore=a("setStartBefore","setEndBefore"),o.setStartAfter=a("setStartAfter","setEndAfter"),o.setEndBefore=a("setEndBefore","setStartBefore"),o.setEndAfter=a("setEndAfter","setStartAfter"),o.selectNodeContents=function(e){this.setStartAndEnd(e,0,r.getNodeLength(e))},h.selectNodeContents(l),h.setEnd(l,3);var g=document.createRange();g.selectNodeContents(l),g.setEnd(l,4),g.setStart(l,2),-1==h.compareBoundaryPoints(h.START_TO_END,g)&&1==h.compareBoundaryPoints(h.END_TO_START,g)?o.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:o.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var p=document.createElement("div");p.innerHTML="123";var m=p.firstChild,R=c(document);R.appendChild(p),h.setStart(m,1),h.setEnd(m,2),h.deleteContents(),"13"==m.data&&(o.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},o.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),R.removeChild(p),R=null,i.isHostMethod(h,"createContextualFragment")&&(o.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(l),h.detach(),g.detach(),o.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=d(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var u=function(e,t,n,o,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(r.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var d=new a(c.parentNode,r.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var u=r.getDocument(c).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var l,h,g,p,m,R=n?"StartToStart":"StartToEnd",v=i&&i.containerElement==c?i.nodeIndex:0,C=c.childNodes.length,N=C,E=N;E==C?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),0!=(l=s.compareEndPoints(R,e))&&v!=N;){if(-1==l){if(N==v+1)break;v=E}else N=N==v+1?v:E;E=Math.floor((v+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==l&&m&&f(m)){var S;if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(m.data)){var w=s.duplicate(),O=w.text.replace(/\r\n/g,"\r").length;for(S=w.moveStart("character",O);-1==(l=w.compareEndPoints("StartToEnd",w));)S++,w.moveStart("character",1)}else S=s.text.length;p=new a(m,S)}else h=(o||!n)&&u.previousSibling,p=(g=(o||n)&&u.nextSibling)&&f(g)?new a(g,0):h&&f(h)?new a(h,h.data.length):new a(c,r.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},l=function(e,t){var n,o,i,a,s=e.offset,d=r.getDocument(e.node),u=c(d).createTextRange(),l=f(e.node);return l?o=(n=e.node).parentNode:(n=s<(a=e.node.childNodes).length?a[s]:null,o=e.node),(i=d.createElement("span")).innerHTML="&#feff;",n?o.insertBefore(i,n):o.appendChild(i),u.moveToElementText(i),u.collapse(!t),o.removeChild(i),l&&u[t?"moveStart":"moveEnd"]("character",s),u};if((o=function(e){this.textRange=e,this.refresh()}).prototype=new s(document),o.prototype.refresh=function(){var e,t,n,o,i=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();(n=e.duplicate()).collapse(!1);var i=n.parentElement(),a=o==i?o:r.getCommonAncestor(o,i);return a==t?a:r.getCommonAncestor(t,a)}(this.textRange);0==(o=this.textRange).compareEndPoints("StartToEnd",o)?t=e=u(this.textRange,i,!0,!0).boundaryPosition:(e=(n=u(this.textRange,i,!0,!1)).boundaryPosition,t=u(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},o.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(o),o.rangeToTextRange=function(e){if(e.collapsed)return l(new a(e.startContainer,e.startOffset),!0);var t=l(new a(e.startContainer,e.startOffset),!0),n=l(new a(e.endContainer,e.endOffset),!1),o=c(s.getRangeDocument(e)).createTextRange();return o.setEndPoint("StartToStart",t),o.setEndPoint("EndToEnd",n),o},e.WrappedTextRange=o,!e.features.implementsDomRange||e.config.preferTextRange){var h=function(){return this}();void 0===h.Range&&(h.Range=o),e.createNativeRange=function(e){return e=d(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=o}}e.createRange=function(n){return n=d(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=d(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){e.config.checkSelectionRanges=!0;var n,o,r="boolean",i="number",a=e.dom,s=e.util,c=s.isHostMethod,d=e.DomRange,f=e.WrappedRange,u=e.DOMException,l=a.DomPosition,h=e.features,g="Control",p=a.getDocument,m=a.getBody,R=d.rangesEqual;function v(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function C(e,n){if(e){if(a.isWindow(e))return e;if(e instanceof Y)return e.win;var o=a.getContentDocument(e,t,n);return a.getWindow(o)}return window}function N(e){return C(e,"getDocSelection").document.selection}function E(e){var t=!1;return e.anchorNode&&(t=1==a.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var S=c(window,"getSelection"),w=s.isHostObject(document,"selection");h.implementsWinGetSelection=S,h.implementsDocSelection=w;var O=w&&(!S||e.config.preferTextRange);O?(n=N,e.isSelectionValid=function(e){var t=C(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||p(n.createRange().parentElement())==t}):S?(n=function(e){return C(e,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=n;var y=n(),T=e.createNativeRange(document),_=m(document),D=s.areHostProperties(y,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=D;var A=c(y,"extend");h.selectionHasExtend=A;var x=typeof y.rangeCount==i;h.selectionHasRangeCount=x;var P=!1,b=!0,I=A?function(t,n){var o=d.getRangeDocument(n),r=e.createRange(o);r.collapseToPoint(n.endContainer,n.endOffset),t.addRange(k(r)),t.extend(n.startContainer,n.startOffset)}:null;s.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount==i&&h.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,o=n>1,r=[],i=E(t),a=0;a<n;++a)r[a]=t.getRangeAt(a);var s=m(document),c=s.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("   ")),f=document.createRange();if(f.setStart(d,1),f.collapse(!0),t.addRange(f),b=1==t.rangeCount,t.removeAllRanges(),!o){var u=f.cloneRange();f.setStart(d,0),u.setEnd(d,3),u.setStart(d,2),t.addRange(f),t.addRange(u),P=2==t.rangeCount,u.detach()}for(s.removeChild(c),t.removeAllRanges(),f.detach(),a=0;a<n;++a)0==a&&i?I?I(t,r[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(r[a])):t.addRange(r[a])}}(),h.selectionSupportsMultipleRanges=P,h.collapsedNonEditableSelectionsSupported=b;var B,H,M=!1;function L(e,t,n){var o=n?"end":"start",r=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function W(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function k(t){var n;return t instanceof d?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof f?n=t.nativeRange:h.implementsDomRange&&t instanceof a.getWindow(t.startContainer).Range&&(n=t),n}function F(e){var n=e.getNodes();if(!function(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!a.isAncestorOf(e[0],e[t]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function U(e){return!!e&&void 0!==e.text}function j(e,t){var n=new f(t);e._ranges=[n],L(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function V(t){if(t._ranges.length=0,"None"==t.docSelection.type)W(t);else{var n=t.docSelection.createRange();if(U(n))j(t,n);else{t.rangeCount=n.length;for(var o,r=p(n.item(0)),i=0;i<t.rangeCount;++i)(o=e.createRange(r)).selectNode(n.item(i)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,L(t,t._ranges[t.rangeCount-1],!1)}}}function z(e,n){for(var o=e.docSelection.createRange(),r=F(n),i=p(o.item(0)),a=m(i).createControlRange(),s=0,c=o.length;s<c;++s)a.add(o.item(s));try{a.add(r)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),V(e)}function Y(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function q(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}_&&c(_,"createControlRange")&&(B=_.createControlRange(),s.areHostProperties(B,["item","add"])&&(M=!0)),h.implementsControlRange=M,o=D?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},c(y,"getRangeAt")?H=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:D&&(H=function(t){var n=p(t.anchorNode),o=e.createRange(n);return o.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),o}),Y.prototype=e.selectionPrototype;var Q=[];function G(e,t){for(var n,o,r=Q.length;r--;)if(o=(n=Q[r]).selection,"deleteAll"==t)q(o);else if(n.win==e)return"delete"==t?(Q.splice(r,1),!0):o;return"deleteAll"==t&&(Q.length=0),null}var X=function(e){if(e&&e instanceof Y)return e.refresh(),e;var t=G(e=C(e,"getNativeSelection")),o=n(e),r=w?N(e):null;return t?(t.nativeSelection=o,t.docSelection=r,t.refresh()):(t=new Y(o,r,e),Q.push({win:e,selection:t})),t};e.getSelection=X,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(a.getIframeWindow(n))};var Z,$=Y.prototype;function J(e,n){for(var o,r=p(n[0].startContainer),i=m(r).createControlRange(),a=0,s=n.length;a<s;++a){o=F(n[a]);try{i.add(o)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),V(e)}if(!O&&D&&s.areHostMethods(y,["removeAllRanges","addRange"])){$.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),W(this)};var K=function(e,t){I(e.nativeSelection,t),e.refresh()};$.addRange=x?function(t,n){var r;if(M&&w&&this.docSelection.type==g)z(this,t);else if(v(n)&&A)K(this,t);else if(P?r=this.rangeCount:(this.removeAllRanges(),r=0),this.nativeSelection.addRange(k(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(e.config.checkSelectionRanges){var i=H(this.nativeSelection,this.rangeCount-1);i&&!R(i,t)&&(t=new f(i))}this._ranges[this.rangeCount-1]=t,L(this,t,ee(this.nativeSelection)),this.isCollapsed=o(this)}else this.refresh()}:function(e,t){v(t)&&A?K(this,e):(this.nativeSelection.addRange(k(e)),this.refresh())},$.setRanges=function(e){if(M&&e.length>1)J(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(c(y,"empty")&&c(T,"select")&&M&&O))return t.fail("No means of selecting a Range or TextRange was found"),!1;$.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=p(this.anchorNode);else if(this.docSelection.type==g){var t=this.docSelection.createRange();t.length&&(e=p(t.item(0)))}if(e)m(e).createTextRange().select(),this.docSelection.empty()}}catch(e){}W(this)},$.addRange=function(t){this.docSelection.type==g?z(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,L(this,t,!1))},$.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?J(this,e):t&&this.addRange(e[0])}}if($.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new u("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},O)Z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=m(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==g?V(t):U(n)?j(t,n):W(t)};else if(c(y,"getRangeAt")&&typeof y.rangeCount==i)Z=function(t){if(M&&w&&t.docSelection.type==g)V(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));L(t,t._ranges[t.rangeCount-1],ee(t.nativeSelection)),t.isCollapsed=o(t)}else W(t)};else{if(!D||typeof y.isCollapsed!=r||typeof T.collapsed!=r||!h.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;Z=function(e){var t,n,r,i=e.nativeSelection;i.anchorNode?(t=H(i,0),e._ranges=[t],e.rangeCount=1,r=(n=e).nativeSelection,n.anchorNode=r.anchorNode,n.anchorOffset=r.anchorOffset,n.focusNode=r.focusNode,n.focusOffset=r.focusOffset,e.isCollapsed=o(e)):W(e)}}$.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(Z(this),e){var r=t.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!R(t[r],this._ranges[r]))return!0;return!1}};var ee,te=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var o=0,r=n.length;o<r;++o)R(t,n[o])||e.addRange(n[o]);e.rangeCount||W(e)};function ne(e,t){if(e.win.document!=p(t))throw new u("WRONG_DOCUMENT_ERR")}function oe(t){return function(n,o){var r;this.rangeCount?(r=this.getRangeAt(0))["set"+(t?"Start":"End")](n,o):(r=e.createRange(this.win.document)).setStartAndEnd(n,o),this.setSingleRange(r,this.isBackward())}}function re(e){var t=[],n=new l(e.anchorNode,e.anchorOffset),o=new l(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=d.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}$.removeRange=M?function(e){if(this.docSelection.type==g){for(var t=this.docSelection.createRange(),n=F(e),o=p(t.item(0)),r=m(o).createControlRange(),i=!1,a=0,s=t.length;a<s;++a)t.item(a)!==n||i?r.add(t.item(a)):i=!0;r.select(),V(this)}else te(this,e)}:function(e){te(this,e)},!O&&D&&h.implementsDomRange?(ee=E,$.isBackward=function(){return ee(this)}):ee=$.isBackward=function(){return!1},$.isBackwards=$.isBackward,$.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},$.collapse=function(t,n){ne(this,t);var o=e.createRange(t);o.collapseToPoint(t,n),this.setSingleRange(o),this.isCollapsed=!0},$.collapseToStart=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},$.collapseToEnd=function(){if(!this.rangeCount)throw new u("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},$.selectAllChildren=function(t){ne(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},$.deleteFromDocument=function(){if(M&&w&&this.docSelection.type==g){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;o<r;++o)n[o].deleteContents();this.addRange(n[r-1])}}},$.eachRange=function(e,t){for(var n=0,o=this._ranges.length;n<o;++n)if(e(this.getRangeAt(n)))return t},$.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},$.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},$.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(o){n.push(o[e].apply(o,t))}),n},$.setStart=oe(!0),$.setEnd=oe(!1),e.rangePrototype.select=function(e){X(this.getDocument()).setSingleRange(this,e)},$.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},$.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},$.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},$.moveToBookmark=function(t){for(var n,o,r=[],i=0;n=t.rangeBookmarks[i++];)(o=e.createRange(this.win)).moveToBookmark(n),r.push(o);t.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},$.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},$.getName=function(){return"WrappedSelection"},$.inspect=function(){return re(this)},$.detach=function(){G(this.win,"delete"),q(this)},Y.detachAll=function(){G(null,"deleteAll")},Y.inspect=re,Y.isDirectionBackward=v,e.Selection=Y,e.selectionPrototype=$,e.addCreateMissingNativeApiListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return X(e)}),e=null})});
